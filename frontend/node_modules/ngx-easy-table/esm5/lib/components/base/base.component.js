/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { moveItemInArray } from '@angular/cdk/drag-drop';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, EventEmitter, Input, Output, TemplateRef, ViewChild, } from '@angular/core';
import { Event, API, } from '../..';
import { DefaultConfigService } from '../../services/config-service';
import { PaginationComponent } from '../pagination/pagination.component';
import { GroupRowsService } from '../../services/group-rows.service';
import { StyleService } from '../../services/style.service';
/**
 * @record
 */
function RowContextMenuPosition() { }
if (false) {
    /** @type {?} */
    RowContextMenuPosition.prototype.top;
    /** @type {?} */
    RowContextMenuPosition.prototype.left;
    /** @type {?} */
    RowContextMenuPosition.prototype.value;
}
var BaseComponent = /** @class */ (function () {
    function BaseComponent(cdr) {
        this.cdr = cdr;
        this.tableClass = null;
        this.grouped = [];
        this.menuActive = false;
        this.isSelected = false;
        this.page = 1;
        this.count = null;
        this.sortState = new Map();
        this.sortKey = null;
        this.rowContextMenuPosition = {
            top: null,
            left: null,
            value: null,
        };
        this.sortBy = {
            key: '',
            order: 'asc',
        };
        this.selectedDetailsTemplateRowId = new Set();
        this.loadingHeight = '30px';
        this.onSelectAllBinded = this.onSelectAll.bind(this);
        this.id = 'table';
        this.event = new EventEmitter();
    }
    Object.defineProperty(BaseComponent.prototype, "configuration", {
        get: /**
         * @return {?}
         */
        function () {
            return this.config;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.config = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    BaseComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (!this.columns) {
            console.error('[columns] property required!');
        }
        if (this.configuration) {
            DefaultConfigService.config = this.configuration;
        }
        this.config = DefaultConfigService.config;
        this.limit = this.config.rows;
        if (this.groupRowsBy) {
            this.grouped = GroupRowsService.doGroupRows(this.data, this.groupRowsBy);
        }
        this.doDecodePersistedState();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    BaseComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var data = changes.data;
        /** @type {?} */
        var pagination = changes.pagination;
        /** @type {?} */
        var groupRowsBy = changes.groupRowsBy;
        this.toggleRowIndex = changes.toggleRowIndex;
        if (data && data.currentValue) {
            this.doApplyData(data);
        }
        if (pagination && pagination.currentValue) {
            this.count = pagination.currentValue.count;
        }
        if (groupRowsBy && groupRowsBy.currentValue) {
            this.grouped = GroupRowsService.doGroupRows(this.data, this.groupRowsBy);
        }
        if (this.toggleRowIndex && this.toggleRowIndex.currentValue) {
            /** @type {?} */
            var row = this.toggleRowIndex.currentValue;
            this.collapseRow(row.index);
        }
    };
    /**
     * @param {?} column
     * @return {?}
     */
    BaseComponent.prototype.isOrderEnabled = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        /** @type {?} */
        var columnOrderEnabled = column.orderEnabled === undefined ? true : !!column.orderEnabled;
        return DefaultConfigService.config.orderEnabled && columnOrderEnabled;
    };
    /**
     * @param {?} column
     * @return {?}
     */
    BaseComponent.prototype.orderBy = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        if (typeof column.orderEnabled !== 'undefined' && !column.orderEnabled) {
            return;
        }
        this.sortKey = column.key;
        if (!DefaultConfigService.config.orderEnabled || this.sortKey === '') {
            return;
        }
        this.setColumnOrder(this.sortKey);
        if (!DefaultConfigService.config.orderEventOnly && !column.orderEventOnly) {
            this.sortBy.key = this.sortKey;
            this.sortBy.order = this.sortState.get(this.sortKey);
        }
        else {
            this.sortBy.key = '';
            this.sortBy.order = '';
        }
        if (!DefaultConfigService.config.serverPagination) {
            this.data = tslib_1.__spread(this.data);
        }
        this.sortBy = tslib_1.__assign({}, this.sortBy);
        /** @type {?} */
        var value = {
            key: this.sortKey,
            order: this.sortState.get(this.sortKey),
        };
        this.emitEvent(Event.onOrder, value);
    };
    /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.onClick = /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    function ($event, row, key, colIndex, rowIndex) {
        if (DefaultConfigService.config.selectRow) {
            this.selectedRow = rowIndex;
        }
        if (DefaultConfigService.config.selectCol && colIndex) {
            this.selectedCol = colIndex;
        }
        if (DefaultConfigService.config.selectCell && colIndex) {
            this.selectedRow = rowIndex;
            this.selectedCol = colIndex;
        }
        if (DefaultConfigService.config.clickEvent) {
            /** @type {?} */
            var value = {
                event: $event,
                row: row,
                key: key,
                rowId: rowIndex,
                colId: colIndex,
            };
            this.emitEvent(Event.onClick, value);
        }
    };
    /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.onDoubleClick = /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    function ($event, row, key, colIndex, rowIndex) {
        /** @type {?} */
        var value = {
            event: $event,
            row: row,
            key: key,
            rowId: rowIndex,
            colId: colIndex,
        };
        this.emitEvent(Event.onDoubleClick, value);
    };
    /**
     * @param {?} $event
     * @param {?} row
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.onCheckboxSelect = /**
     * @param {?} $event
     * @param {?} row
     * @param {?} rowIndex
     * @return {?}
     */
    function ($event, row, rowIndex) {
        /** @type {?} */
        var value = {
            event: $event,
            row: row,
            rowId: rowIndex,
        };
        this.emitEvent(Event.onCheckboxSelect, value);
    };
    /**
     * @return {?}
     */
    BaseComponent.prototype.onSelectAll = /**
     * @return {?}
     */
    function () {
        this.isSelected = !this.isSelected;
        this.emitEvent(Event.onSelectAll, this.isSelected);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    BaseComponent.prototype.onSearch = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (!DefaultConfigService.config.serverPagination) {
            this.term = $event;
        }
        this.emitEvent(Event.onSearch, $event);
    };
    /**
     * @param {?} value
     * @return {?}
     */
    BaseComponent.prototype.onGlobalSearch = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (!DefaultConfigService.config.serverPagination) {
            this.globalSearchTerm = value;
        }
        this.emitEvent(Event.onGlobalSearch, value);
    };
    /**
     * @param {?} pagination
     * @return {?}
     */
    BaseComponent.prototype.onPagination = /**
     * @param {?} pagination
     * @return {?}
     */
    function (pagination) {
        this.page = pagination.page;
        this.limit = pagination.limit;
        this.emitEvent(Event.onPagination, pagination);
    };
    /**
     * @private
     * @param {?} event
     * @param {?} value
     * @return {?}
     */
    BaseComponent.prototype.emitEvent = /**
     * @private
     * @param {?} event
     * @param {?} value
     * @return {?}
     */
    function (event, value) {
        this.event.emit({ event: event, value: value });
        if (this.config.persistState) {
            localStorage.setItem(event, JSON.stringify(value));
        }
        if (this.config.logger) {
            // tslint:disable-next-line:no-console
            console.log({ event: event, value: value });
        }
    };
    /**
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.collapseRow = /**
     * @param {?} rowIndex
     * @return {?}
     */
    function (rowIndex) {
        if (this.selectedDetailsTemplateRowId.has(rowIndex)) {
            this.selectedDetailsTemplateRowId.delete(rowIndex);
            this.emitEvent(Event.onRowCollapsedHide, rowIndex);
        }
        else {
            this.selectedDetailsTemplateRowId.add(rowIndex);
            this.emitEvent(Event.onRowCollapsedShow, rowIndex);
        }
    };
    /**
     * @private
     * @return {?}
     */
    BaseComponent.prototype.doDecodePersistedState = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.config.persistState) {
            return;
        }
        /** @type {?} */
        var pagination = localStorage.getItem(Event.onPagination);
        /** @type {?} */
        var sort = localStorage.getItem(Event.onOrder);
        /** @type {?} */
        var search = localStorage.getItem(Event.onSearch);
        if (pagination) {
            this.onPagination(JSON.parse(pagination));
        }
        if (sort) {
            var _a = JSON.parse(sort), key = _a.key, order = _a.order;
            this.sortBy.key = key;
            this.sortBy.order = order;
            this.data = tslib_1.__spread(this.data);
        }
        if (search) {
            this.term = JSON.parse(search);
        }
    };
    /**
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.isRowCollapsed = /**
     * @param {?} rowIndex
     * @return {?}
     */
    function (rowIndex) {
        if (this.config.collapseAllRows) {
            return true;
        }
        return this.selectedDetailsTemplateRowId.has(rowIndex);
    };
    /**
     * @param {?} event
     * @param {?} th
     * @return {?}
     */
    BaseComponent.prototype.onMouseDown = /**
     * @param {?} event
     * @param {?} th
     * @return {?}
     */
    function (event, th) {
        if (!this.config.resizeColumn) {
            return;
        }
        this.th = th;
        this.startOffset = th.offsetWidth - event.pageX;
        this.emitEvent(Event.onColumnResizeMouseDown, event);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    BaseComponent.prototype.onMouseMove = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!this.config.resizeColumn) {
            return;
        }
        if (this.th && this.th.style) {
            this.th.style.width = this.startOffset + event.pageX + 'px';
            this.th.style.cursor = 'col-resize';
            this.th.style['user-select'] = 'none';
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    BaseComponent.prototype.onMouseUp = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!this.config.resizeColumn) {
            return;
        }
        this.emitEvent(Event.onColumnResizeMouseUp, event);
        this.th.style.cursor = 'default';
        this.th = undefined;
    };
    Object.defineProperty(BaseComponent.prototype, "isLoading", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var table = (/** @type {?} */ (document.getElementById('table')));
            if (table && table.rows && table.rows.length > 3) {
                this.getLoadingHeight(table.rows);
            }
            return this.config.isLoading;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} rows
     * @return {?}
     */
    BaseComponent.prototype.getLoadingHeight = /**
     * @param {?} rows
     * @return {?}
     */
    function (rows) {
        /** @type {?} */
        var searchEnabled = this.config.searchEnabled ? 1 : 0;
        /** @type {?} */
        var headerEnabled = this.config.headerEnabled ? 1 : 0;
        /** @type {?} */
        var borderTrHeight = 1;
        /** @type {?} */
        var borderDivHeight = 2;
        this.loadingHeight = (rows.length - searchEnabled - headerEnabled) * (rows[3].offsetHeight - borderTrHeight) - borderDivHeight + 'px';
    };
    /**
     * @param {?} column
     * @return {?}
     */
    BaseComponent.prototype.getColumnWidth = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        if (column.width) {
            return column.width;
        }
        return this.config.fixedColumnWidth ? 100 / this.columns.length + '%' : null;
    };
    /**
     * @param {?} column
     * @return {?}
     */
    BaseComponent.prototype.getColumnDefinition = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        return column.searchEnabled || typeof column.searchEnabled === 'undefined';
    };
    Object.defineProperty(BaseComponent.prototype, "arrowDefinition", {
        get: /**
         * @return {?}
         */
        function () {
            return this.config.showDetailsArrow || typeof this.config.showDetailsArrow === 'undefined';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.onRowContextMenu = /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    function ($event, row, key, colIndex, rowIndex) {
        if (!this.config.showContextMenu) {
            return;
        }
        $event.preventDefault();
        /** @type {?} */
        var value = {
            event: $event,
            row: row,
            key: key,
            rowId: rowIndex,
            colId: colIndex,
        };
        this.rowContextMenuPosition = {
            top: $event.y - 10 + "px",
            left: $event.x - 10 + "px",
            value: value,
        };
        this.emitEvent(Event.onRowContextMenu, value);
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    BaseComponent.prototype.doApplyData = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var column = this.columns.find((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return !!c.orderBy; }));
        if (column) {
            this.sortState.set(this.sortKey, (column.orderBy === 'asc') ? 'desc' : 'asc');
            this.orderBy(column);
        }
        else {
            this.data = tslib_1.__spread(data.currentValue);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    BaseComponent.prototype.onDrop = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.emitEvent(Event.onRowDrop, event);
        moveItemInArray(this.data, event.previousIndex, event.currentIndex);
    };
    // DO NOT REMOVE. It is called from parent component. See src/app/demo/api-doc/api-doc.component.ts
    // DO NOT REMOVE. It is called from parent component. See src/app/demo/api-doc/api-doc.component.ts
    /**
     * @param {?} event
     * @return {?}
     */
    BaseComponent.prototype.apiEvent = 
    // DO NOT REMOVE. It is called from parent component. See src/app/demo/api-doc/api-doc.component.ts
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        return this.bindApi(event);
    };
    // tslint:disable:no-big-function cognitive-complexity
    // tslint:disable:no-big-function cognitive-complexity
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    BaseComponent.prototype.bindApi = 
    // tslint:disable:no-big-function cognitive-complexity
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        switch (event.type) {
            case API.rowContextMenuClicked:
                this.rowContextMenuPosition = {
                    top: null,
                    left: null,
                    value: null,
                };
                break;
            case API.toolPanelClicked:
                // TODO
                break;
            case API.setInputValue:
                if (this.config.searchEnabled) {
                    event.value.forEach((/**
                     * @param {?} input
                     * @return {?}
                     */
                    function (input) {
                        /** @type {?} */
                        var element = ((/** @type {?} */ (document.getElementById("search_" + input.key))));
                        if (!element) {
                            console.error("Column '" + input.key + "' not available in the DOM. Have you misspelled a name?");
                        }
                        else {
                            element.value = input.value;
                        }
                    }));
                }
                this.onSearch(event.value);
                this.cdr.detectChanges();
                break;
            case API.onGlobalSearch:
                this.onGlobalSearch(event.value);
                this.cdr.detectChanges();
                break;
            case API.setRowClass:
                if (Array.isArray(event.value)) {
                    event.value.forEach((/**
                     * @param {?} val
                     * @return {?}
                     */
                    function (val) { return StyleService.setRowClass(val); }));
                    break;
                }
                StyleService.setRowClass(event.value);
                this.cdr.detectChanges();
                break;
            case API.setCellClass:
                if (Array.isArray(event.value)) {
                    event.value.forEach((/**
                     * @param {?} val
                     * @return {?}
                     */
                    function (val) { return StyleService.setCellClass(val); }));
                    break;
                }
                StyleService.setCellClass(event.value);
                break;
            case API.setRowStyle:
                if (Array.isArray(event.value)) {
                    event.value.forEach((/**
                     * @param {?} val
                     * @return {?}
                     */
                    function (val) { return StyleService.setRowStyle(val); }));
                    break;
                }
                StyleService.setRowStyle(event.value);
                break;
            case API.setCellStyle:
                if (Array.isArray(event.value)) {
                    event.value.forEach((/**
                     * @param {?} val
                     * @return {?}
                     */
                    function (val) { return StyleService.setCellStyle(val); }));
                    break;
                }
                StyleService.setCellStyle(event.value);
                break;
            case API.setTableClass:
                this.tableClass = event.value;
                this.cdr.detectChanges();
                break;
            case API.getPaginationTotalItems:
                return this.paginationComponent.paginationDirective.getTotalItems();
            case API.setPaginationCurrentPage:
                this.paginationComponent.paginationDirective.setCurrent(event.value);
                break;
            case API.setPaginationRange:
                this.paginationComponent.ranges = event.value;
                break;
            case API.setPaginationPreviousLabel:
                this.paginationComponent.previousLabel = event.value;
                break;
            case API.setPaginationNextLabel:
                this.paginationComponent.nextLabel = event.value;
                break;
            case API.setPaginationDisplayLimit:
                this.paginationComponent.changeLimit(event.value, true);
                break;
            case API.sortBy:
                /** @type {?} */
                var column = { title: '', key: event.value.column, orderBy: event.value.order };
                this.orderBy(column);
                this.cdr.detectChanges();
                break;
            default:
                break;
        }
    };
    /**
     * @private
     * @param {?} key
     * @return {?}
     */
    BaseComponent.prototype.setColumnOrder = /**
     * @private
     * @param {?} key
     * @return {?}
     */
    function (key) {
        switch (this.sortState.get(key)) {
            case '':
            case undefined:
                this.sortState.set(key, 'desc');
                break;
            case 'asc':
                this.config.threeWaySort ?
                    this.sortState.set(key, '') :
                    this.sortState.set(key, 'desc');
                break;
            case 'desc':
                this.sortState.set(key, 'asc');
                break;
        }
        if (this.sortState.size > 1) {
            /** @type {?} */
            var temp = this.sortState.get(key);
            this.sortState.clear();
            this.sortState.set(key, temp);
        }
    };
    BaseComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ngx-table',
                    providers: [DefaultConfigService, GroupRowsService, StyleService],
                    template: "<div class=\"ngx-container\">\n  <table [id]=\"id\"\n         [ngClass]=\"(tableClass === null || tableClass === '') ? 'ngx-table' : tableClass\"\n         [class.ngx-table__table--tiny]=\"config.tableLayout.style === 'tiny'\"\n         [class.ngx-table__table--normal]=\"config.tableLayout.style === 'normal'\"\n         [class.ngx-table__table--big]=\"config.tableLayout.style === 'big'\"\n         [class.ngx-table__table--borderless]=\"config.tableLayout.borderless\"\n         [class.ngx-table__table--dark]=\"config.tableLayout.theme === 'dark'\"\n         [class.ngx-table__table--hoverable]=\"config.tableLayout.hover\"\n         [class.ngx-table__table--striped]=\"config.tableLayout.striped\"\n         [class.ngx-table__horizontal-scroll]=\"config.horizontalScroll && !isLoading\">\n    <thead>\n    <tr class=\"ngx-table__header\" *ngIf=\"config.headerEnabled\">\n      <th *ngIf=\"config.checkboxes\" width=\"3%\">\n        <ng-container\n          *ngIf=\"selectAllTemplate\"\n          [ngTemplateOutlet]=\"selectAllTemplate\"\n          [ngTemplateOutletContext]=\"{ $implicit: onSelectAllBinded }\">\n        </ng-container>\n        <label class=\"ngx-form-checkbox\" *ngIf=\"!selectAllTemplate\">\n          <input type=\"checkbox\" (change)=\"onSelectAll()\">\n          <i class=\"ngx-form-icon\" id=\"selectAllCheckbox\"></i>\n        </label>\n      </th>\n      <ng-container *ngFor=\"let column of columns;\">\n        <th class=\"ngx-table__header-cell\"\n            #th\n            [attr.width]=\"getColumnWidth(column)\"\n            (mousedown)=\"onMouseDown($event, th)\"\n            (mouseup)=\"onMouseUp($event)\"\n            (mousemove)=\"onMouseMove($event)\">\n          <div (click)=\"orderBy(column)\" [class.pointer]=\"isOrderEnabled(column)\">\n            <div class=\"ngx-table__header-title\">{{ column.title }}<span>&nbsp;</span>\n              <div [style.display]=\"config.orderEnabled ? 'inline' : 'none' \">\n                <span *ngIf=\"sortKey === column.key && this.sortState.get(sortKey) === ''\"> -</span>\n                <i *ngIf=\"sortKey === column.key && this.sortState.get(sortKey) === 'asc'\"\n                   class=\"ngx-icon ngx-icon-arrow-up\">\n                </i>\n                <i *ngIf=\"sortKey === column.key && this.sortState.get(sortKey) === 'desc'\"\n                   class=\"ngx-icon ngx-icon-arrow-down\">\n                </i>\n              </div>\n            </div>\n          </div>\n          <div class=\"ngx-table__column-resizer\" *ngIf=\"config.resizeColumn\"></div>\n        </th>\n      </ng-container>\n      <th *ngIf=\"config.additionalActions || config.detailsTemplate || config.collapseAllRows || config.groupRows\"\n          class=\"ngx-table__header-cell-additional-actions\">\n        <div class=\"ngx-dropdown ngx-active\"\n             *ngIf=\"config.additionalActions\"\n             [class.ngx-active]=\"menuActive\">\n          <a class=\"ngx-btn ngx-btn-link\" (click)=\"menuActive = !menuActive\">\n            <span class=\"ngx-icon ngx-icon-menu\"></span>\n          </a>\n          <ul class=\"ngx-menu ngx-table__table-menu\">\n            <li class=\"ngx-menu-item\">\n              <app-csv-export [data]=\"data\"\n                              *ngIf=\"config.exportEnabled\">\n              </app-csv-export>\n            </li>\n          </ul>\n        </div>\n      </th>\n    </tr>\n    <tr *ngIf=\"config.searchEnabled && !filtersTemplate\"\n        class=\"ngx-table__sort-header\">\n      <th *ngIf=\"config.checkboxes\"></th>\n      <ng-container *ngFor=\"let column of columns\">\n        <th>\n          <table-header\n            *ngIf=\"getColumnDefinition(column)\"\n            (update)=\"onSearch($event)\"\n            [column]=\"column\">\n          </table-header>\n        </th>\n      </ng-container>\n      <th *ngIf=\"config.additionalActions || config.detailsTemplate\"></th>\n    </tr>\n    <ng-container *ngIf=\"filtersTemplate\">\n      <tr>\n        <ng-container [ngTemplateOutlet]=\"filtersTemplate\">\n        </ng-container>\n      </tr>\n    </ng-container>\n    </thead>\n    <tbody *ngIf=\"data && !isLoading  && !config.draggable\">\n    <ng-container *ngIf=\"rowTemplate\">\n      <ul class=\"ngx-table__table-row-context-menu\"\n          [ngStyle]=\"{'position': 'absolute', 'top': rowContextMenuPosition.top, 'left': rowContextMenuPosition.left }\"\n          *ngIf=\"rowContextMenuPosition.top\">\n        <ng-container\n          [ngTemplateOutlet]=\"rowContextMenu\"\n          [ngTemplateOutletContext]=\"{ $implicit: rowContextMenuPosition.value}\">\n        </ng-container>\n      </ul>\n      <ng-container *ngFor=\"let row of data | sort:sortBy | search:term | global:globalSearchTerm | paginate: { itemsPerPage: limit, currentPage: page, totalItems: count, id: id };\n              let rowIndex = index\">\n        <tr\n          (click)=\"onClick($event, row, '', null, rowIndex)\"\n          (contextmenu)=\"onRowContextMenu($event, row, '', null, rowIndex)\"\n          (dblclick)=\"onDoubleClick($event, row, '', null, rowIndex)\"\n          [class.ngx-table__table-row--selected]=\"rowIndex == selectedRow && !config.selectCell\">\n          <ng-container\n            [ngTemplateOutlet]=\"rowTemplate\"\n            [ngTemplateOutletContext]=\"{ $implicit: row, index: rowIndex }\">\n          </ng-container>\n          <td *ngIf=\"config.detailsTemplate\">\n            <span class=\"ngx-icon\"\n                  *ngIf=\"arrowDefinition\"\n                  [ngClass]=\"isRowCollapsed(rowIndex) ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'\"\n                  (click)=\"collapseRow(rowIndex)\">\n            </span>\n          </td>\n        </tr>\n        <tr\n          *ngIf=\"(config.detailsTemplate && selectedDetailsTemplateRowId.has(rowIndex)) || config.collapseAllRows\">\n          <td [attr.colspan]=\"columns.length + 1\">\n            <ng-container\n              [ngTemplateOutlet]=\"detailsTemplate\"\n              [ngTemplateOutletContext]=\"{ $implicit: row, index: rowIndex  }\">\n            </ng-container>\n          </td>\n        </tr>\n      </ng-container>\n    </ng-container>\n    <ng-container *ngIf=\"!rowTemplate && !config.groupRows\">\n      <ul class=\"ngx-table__table-row-context-menu\"\n          [ngStyle]=\"{'position': 'absolute', 'top': rowContextMenuPosition.top, 'left': rowContextMenuPosition.left }\"\n          *ngIf=\"rowContextMenuPosition.top\">\n        <ng-container\n          [ngTemplateOutlet]=\"rowContextMenu\"\n          [ngTemplateOutletContext]=\"{ $implicit: rowContextMenuPosition.value}\">\n        </ng-container>\n      </ul>\n      <ng-container\n        *ngFor=\"let row of data | sort:sortBy | search:term | global:globalSearchTerm | paginate: { itemsPerPage: limit, currentPage: page, totalItems: count, id: id };\n                  let rowIndex = index\">\n        <tr [class.ngx-table__table-row--selected]=\"rowIndex == selectedRow && !config.selectCell\">\n          <td *ngIf=\"config.checkboxes\">\n            <label class=\"ngx-form-checkbox\">\n              <input type=\"checkbox\"\n                     id=\"checkbox-{{rowIndex}}\"\n                     [checked]=\"isSelected\"\n                     (change)=\"onCheckboxSelect($event, row, rowIndex)\">\n              <i class=\"ngx-form-icon\"></i>\n            </label>\n          </td>\n          <ng-container *ngFor=\"let column of columns; let colIndex = index\">\n            <td (click)=\"onClick($event, row, column.key, colIndex, rowIndex)\"\n                (contextmenu)=\"onRowContextMenu($event, row, column.key, colIndex, rowIndex)\"\n                (dblclick)=\"onDoubleClick($event, row, column.key, colIndex, rowIndex)\"\n                [class.ngx-table__table-col--selected]=\"colIndex == selectedCol && !config.selectCell\"\n                [class.ngx-table__table-cell--selected]=\"colIndex == selectedCol && rowIndex == selectedRow && !config.selectCol && !config.selectRow\"\n            >\n              <div *ngIf=\"!column.cellTemplate\">{{ row | render:column.key }}</div>\n              <ng-container\n                *ngIf=\"column.cellTemplate\"\n                [ngTemplateOutlet]=\"column.cellTemplate\"\n                [ngTemplateOutletContext]=\"{ $implicit: row, rowIndex: rowIndex }\">\n              </ng-container>\n            </td>\n          </ng-container>\n          <td *ngIf=\"config.additionalActions || config.detailsTemplate\">\n            <span class=\"ngx-icon\"\n                  *ngIf=\"arrowDefinition\"\n                  [ngClass]=\"isRowCollapsed(rowIndex) ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'\"\n                  (click)=\"collapseRow(rowIndex)\">\n            </span>\n          </td>\n        </tr>\n        <tr\n          *ngIf=\"(config.detailsTemplate && selectedDetailsTemplateRowId.has(rowIndex)) || config.collapseAllRows\">\n          <td *ngIf=\"config.checkboxes\"></td>\n          <td [attr.colspan]=\"columns.length + 1\">\n            <ng-container\n              [ngTemplateOutlet]=\"detailsTemplate\"\n              [ngTemplateOutletContext]=\"{ $implicit: row, index: rowIndex }\">\n            </ng-container>\n          </td>\n        </tr>\n      </ng-container>\n    </ng-container>\n    <ng-container *ngIf=\"!rowTemplate && config.groupRows\">\n      <ng-container\n        *ngFor=\"let group of grouped | sort:sortBy:config | search:term:config | global:globalSearchTerm | paginate: { itemsPerPage: limit, currentPage: page, totalItems: count, id: id }; let rowIndex = index\">\n        <tr>\n          <ng-container *ngIf=\"!groupRowsHeaderTemplate\">\n            <td [attr.colspan]=\"columns.length\">\n              <div>{{group[0][groupRowsBy]}} ({{group.length}})</div>\n            </td>\n          </ng-container>\n          <ng-container\n            *ngIf=\"groupRowsHeaderTemplate\"\n            [ngTemplateOutlet]=\"groupRowsHeaderTemplate\"\n            [ngTemplateOutletContext]=\"{\n              total: group.length,\n              key: groupRowsBy,\n              value: group[0] ? group[0][groupRowsBy] : '',\n              group: group,\n              index: rowIndex\n            }\">\n          </ng-container>\n          <td>\n            <span class=\"ngx-icon\"\n                  *ngIf=\"arrowDefinition\"\n                  [ngClass]=\"isRowCollapsed(rowIndex) ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'\"\n                  (click)=\"collapseRow(rowIndex)\">\n            </span>\n          </td>\n        </tr>\n        <ng-container *ngIf=\"selectedDetailsTemplateRowId.has(rowIndex)\">\n          <tr *ngFor=\"let row of group\">\n            <td *ngFor=\"let column of columns\">\n              {{ row | render:column.key }}\n              <!-- TODO allow users to add groupRowsTemplateRef -->\n            </td>\n            <td></td>\n          </tr>\n        </ng-container>\n      </ng-container>\n    </ng-container>\n    </tbody>\n    <tbody *ngIf=\"data && !config.isLoading && config.draggable\" cdkDropList (cdkDropListDropped)=\"onDrop($event)\">\n    <ng-container *ngIf=\"!rowTemplate && !config.groupRows\">\n      <ng-container\n        *ngFor=\"let row of data | sort:sortBy | search:term | global:globalSearchTerm | paginate: { itemsPerPage: limit, currentPage: page, totalItems: count, id: id };\n                  let rowIndex = index\">\n        <tr class=\"ngx-draggable-row\" cdkDrag>\n          <td *ngIf=\"config.checkboxes\">\n            <label class=\"ngx-form-checkbox\">\n              <input type=\"checkbox\"\n                     id=\"checkbox-draggable-{{rowIndex}}\"\n                     [checked]=\"isSelected\"\n                     (change)=\"onCheckboxSelect($event, row, rowIndex)\">\n              <i class=\"ngx-form-icon\"></i>\n            </label>\n          </td>\n          <ng-container *ngFor=\"let column of columns; let colIndex = index\">\n            <td (click)=\"onClick($event, row, column.key, colIndex, rowIndex)\"\n                (dblclick)=\"onDoubleClick($event, row, column.key, colIndex, rowIndex)\"\n                [class.ngx-table__table-col--selected]=\"colIndex == selectedCol && !config.selectCell\"\n                [class.ngx-table__table-cell--selected]=\"colIndex == selectedCol && rowIndex == selectedRow && !config.selectCol && !config.selectRow\"\n            >\n              <div>{{ row | render:column.key }}</div>\n            </td>\n          </ng-container>\n        </tr>\n      </ng-container>\n    </ng-container>\n    </tbody>\n    <tbody *ngIf=\"!isLoading && (!data || (data && data.length < 1))\">\n    <tr class=\"ngx-table__body-empty\">\n      <ng-container\n        *ngIf=\"noResultsTemplate\"\n        [ngTemplateOutlet]=\"noResultsTemplate\">\n      </ng-container>\n      <td [attr.colspan]=\"columns && columns.length + 1\" *ngIf=\"!noResultsTemplate\">\n        <div class=\"ngx-table__table-no-results\">\n          No results\n        </div>\n      </td>\n    </tr>\n    </tbody>\n    <tbody *ngIf=\"isLoading\">\n    <tr class=\"ngx-table__body-loading\">\n      <td [attr.colspan]=\"columns && columns.length + 1\">\n        <div [style.height]=\"loadingHeight\"\n             class=\"ngx-table__table-loader-wrapper\">\n          <div class=\"ngx-table__table-loader\"></div>\n        </div>\n      </td>\n    </tr>\n    </tbody>\n    <tfoot *ngIf=\"summaryTemplate\">\n    <tr>\n      <ng-container\n        [ngTemplateOutlet]=\"summaryTemplate\"\n        [ngTemplateOutletContext]=\"{ total: data.length, limit: limit, page: page  }\">\n      </ng-container>\n    </tr>\n    </tfoot>\n  </table>\n  <pagination\n    [attr.id]=\"'pagination' + id\"\n    *ngIf=\"config.paginationEnabled\"\n    [id]=\"id\"\n    #paginationComponent\n    [config]=\"config\"\n    [pagination]=\"pagination\"\n    (updateRange)=\"onPagination($event)\">\n  </pagination>\n</div>\n",
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    BaseComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    BaseComponent.propDecorators = {
        paginationComponent: [{ type: ViewChild, args: ['paginationComponent',] }],
        th: [{ type: ViewChild, args: ['th',] }],
        configuration: [{ type: Input, args: ['configuration',] }],
        data: [{ type: Input }],
        pagination: [{ type: Input }],
        groupRowsBy: [{ type: Input }],
        id: [{ type: Input }],
        toggleRowIndex: [{ type: Input }],
        detailsTemplate: [{ type: Input }],
        summaryTemplate: [{ type: Input }],
        groupRowsHeaderTemplate: [{ type: Input }],
        filtersTemplate: [{ type: Input }],
        selectAllTemplate: [{ type: Input }],
        noResultsTemplate: [{ type: Input }],
        rowContextMenu: [{ type: Input }],
        columns: [{ type: Input }],
        event: [{ type: Output }],
        rowTemplate: [{ type: ContentChild, args: [TemplateRef,] }]
    };
    return BaseComponent;
}());
export { BaseComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    BaseComponent.prototype.paginationComponent;
    /**
     * @type {?}
     * @private
     */
    BaseComponent.prototype.th;
    /** @type {?} */
    BaseComponent.prototype.selectedRow;
    /** @type {?} */
    BaseComponent.prototype.selectedCol;
    /** @type {?} */
    BaseComponent.prototype.term;
    /** @type {?} */
    BaseComponent.prototype.tableClass;
    /** @type {?} */
    BaseComponent.prototype.globalSearchTerm;
    /** @type {?} */
    BaseComponent.prototype.grouped;
    /** @type {?} */
    BaseComponent.prototype.menuActive;
    /** @type {?} */
    BaseComponent.prototype.isSelected;
    /** @type {?} */
    BaseComponent.prototype.page;
    /** @type {?} */
    BaseComponent.prototype.count;
    /** @type {?} */
    BaseComponent.prototype.sortState;
    /** @type {?} */
    BaseComponent.prototype.sortKey;
    /** @type {?} */
    BaseComponent.prototype.rowContextMenuPosition;
    /** @type {?} */
    BaseComponent.prototype.limit;
    /** @type {?} */
    BaseComponent.prototype.sortBy;
    /** @type {?} */
    BaseComponent.prototype.selectedDetailsTemplateRowId;
    /** @type {?} */
    BaseComponent.prototype.startOffset;
    /** @type {?} */
    BaseComponent.prototype.loadingHeight;
    /** @type {?} */
    BaseComponent.prototype.config;
    /** @type {?} */
    BaseComponent.prototype.onSelectAllBinded;
    /** @type {?} */
    BaseComponent.prototype.data;
    /** @type {?} */
    BaseComponent.prototype.pagination;
    /** @type {?} */
    BaseComponent.prototype.groupRowsBy;
    /** @type {?} */
    BaseComponent.prototype.id;
    /** @type {?} */
    BaseComponent.prototype.toggleRowIndex;
    /** @type {?} */
    BaseComponent.prototype.detailsTemplate;
    /** @type {?} */
    BaseComponent.prototype.summaryTemplate;
    /** @type {?} */
    BaseComponent.prototype.groupRowsHeaderTemplate;
    /** @type {?} */
    BaseComponent.prototype.filtersTemplate;
    /** @type {?} */
    BaseComponent.prototype.selectAllTemplate;
    /** @type {?} */
    BaseComponent.prototype.noResultsTemplate;
    /** @type {?} */
    BaseComponent.prototype.rowContextMenu;
    /** @type {?} */
    BaseComponent.prototype.columns;
    /** @type {?} */
    BaseComponent.prototype.event;
    /** @type {?} */
    BaseComponent.prototype.rowTemplate;
    /**
     * @type {?}
     * @private
     */
    BaseComponent.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtZWFzeS10YWJsZS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2Jhc2UvYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQWUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdEUsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUdMLE1BQU0sRUFHTixXQUFXLEVBQ1gsU0FBUyxHQUNWLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFHTCxLQUFLLEVBQ0wsR0FBRyxHQUtKLE1BQU0sT0FBTyxDQUFDO0FBQ2YsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDckUsT0FBTyxFQUFFLG1CQUFtQixFQUFtQixNQUFNLG9DQUFvQyxDQUFDO0FBQzFGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQzs7OztBQUU1RCxxQ0FJQzs7O0lBSEMscUNBQW1COztJQUNuQixzQ0FBb0I7O0lBQ3BCLHVDQUFrQjs7QUFHcEI7SUE4REUsdUJBQTZCLEdBQXNCO1FBQXRCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBbEQ1QyxlQUFVLEdBQUcsSUFBSSxDQUFDO1FBRWxCLFlBQU8sR0FBUSxFQUFFLENBQUM7UUFDbEIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLFNBQUksR0FBRyxDQUFDLENBQUM7UUFDVCxVQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2IsY0FBUyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7UUFDdEIsWUFBTyxHQUFHLElBQUksQ0FBQztRQUNmLDJCQUFzQixHQUEyQjtZ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QUFpQjs7O3NDQTBDaEIsU0FBUyxTQUFDLHFCQUFxQjtxQkFDL0IsU0FBUyxTQUFDLElBQUk7Z0NBNkJkLEtBQUssU0FBQyxlQUFlO3VCQVNyQixLQUFLOzZCQUNMLEtBQUs7OEJBQ0wsS0FBSztxQkFDTCxLQUFLO2lDQUNMLEtBQUs7a0NBQ0wsS0FBSztrQ0FDTCxLQUFLOzBDQUNMLEtBQUs7a0NBQ0wsS0FBSztvQ0FDTCxLQUFLO29DQUNMLEtBQUs7aUNBQ0wsS0FBSzswQkFDTCxLQUFLO3dCQUNMLE1BQU07OEJBQ04sWUFBWSxTQUFDLFdBQVc7O0lBbVozQixvQkFBQztDQUFBLEFBL2NELElBK2NDO1NBemNZLGFBQWE7Ozs7OztJQUN4Qiw0Q0FBbUY7Ozs7O0lBQ25GLDJCQUE0Qjs7SUFDNUIsb0NBQTJCOztJQUMzQixvQ0FBMkI7O0lBQzNCLDZCQUFZOztJQUNaLG1DQUF5Qjs7SUFDekIseUNBQWdDOztJQUNoQyxnQ0FBeUI7O0lBQ3pCLG1DQUEwQjs7SUFDMUIsbUNBQTBCOztJQUMxQiw2QkFBZ0I7O0lBQ2hCLDhCQUFvQjs7SUFDcEIsa0NBQTZCOztJQUM3QixnQ0FBc0I7O0lBQ3RCLCtDQUlFOztJQUNGLDhCQUFhOztJQUNiLCtCQUdFOztJQUNGLHFEQUFnRDs7SUFDaEQsb0NBQW1COztJQUNuQixzQ0FBOEI7O0lBQzlCLCtCQUFzQjs7SUFDdEIsMENBQWdEOztJQVdoRCw2QkFBcUI7O0lBQ3JCLG1DQUFnQzs7SUFDaEMsb0NBQTZCOztJQUM3QiwyQkFBc0I7O0lBQ3RCLHVDQUF3Qjs7SUFDeEIsd0NBQTJDOztJQUMzQyx3Q0FBMkM7O0lBQzNDLGdEQUFtRDs7SUFDbkQsd0NBQTJDOztJQUMzQywwQ0FBNkM7O0lBQzdDLDBDQUE2Qzs7SUFDN0MsdUNBQTBDOztJQUMxQyxnQ0FBNEI7O0lBQzVCLDhCQUE2RTs7SUFDN0Usb0NBQWdFOzs7OztJQUVwRCw0QkFBdUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDZGtEcmFnRHJvcCwgbW92ZUl0ZW1JbkFycmF5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2RyYWctZHJvcCc7XG5pbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBTaW1wbGVDaGFuZ2UsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQge1xuICBDb2x1bW5zLFxuICBDb25maWcsXG4gIEV2ZW50LFxuICBBUEksXG4gIFBhZ2luYXRpb24sXG4gIENvbHVtbktleVR5cGUsXG4gIFRhYmxlTW91c2VFdmVudCxcbiAgQXBpVHlwZSxcbn0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IHsgRGVmYXVsdENvbmZpZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jb25maWctc2VydmljZSc7XG5pbXBvcnQgeyBQYWdpbmF0aW9uQ29tcG9uZW50LCBQYWdpbmF0aW9uUmFuZ2UgfSBmcm9tICcuLi9wYWdpbmF0aW9uL3BhZ2luYXRpb24uY29tcG9uZW50JztcbmltcG9ydCB7IEdyb3VwUm93c1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9ncm91cC1yb3dzLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3R5bGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc3R5bGUuc2VydmljZSc7XG5cbmludGVyZmFjZSBSb3dDb250ZXh0TWVudVBvc2l0aW9uIHtcbiAgdG9wOiBzdHJpbmcgfCBudWxsO1xuICBsZWZ0OiBzdHJpbmcgfCBudWxsO1xuICB2YWx1ZTogYW55IHwgbnVsbDtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LXRhYmxlJyxcbiAgcHJvdmlkZXJzOiBbRGVmYXVsdENvbmZpZ1NlcnZpY2UsIEdyb3VwUm93c1NlcnZpY2UsIFN0eWxlU2VydmljZV0sXG4gIHRlbXBsYXRlVXJsOiAnLi9iYXNlLmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG4gIEBWaWV3Q2hpbGQoJ3BhZ2luYXRpb25Db21wb25lbnQnKSBwcml2YXRlIHBhZ2luYXRpb25Db21wb25lbnQ6IFBhZ2luYXRpb25Db21wb25lbnQ7XG4gIEBWaWV3Q2hpbGQoJ3RoJykgcHJpdmF0ZSB0aDtcbiAgcHVibGljIHNlbGVjdGVkUm93OiBudW1iZXI7XG4gIHB1YmxpYyBzZWxlY3RlZENvbDogbnVtYmVyO1xuICBwdWJsaWMgdGVybTtcbiAgcHVibGljIHRhYmxlQ2xhc3MgPSBudWxsO1xuICBwdWJsaWMgZ2xvYmFsU2VhcmNoVGVybTogc3RyaW5nO1xuICBwdWJsaWMgZ3JvdXBlZDogYW55ID0gW107XG4gIHB1YmxpYyBtZW51QWN0aXZlID0gZmFsc2U7XG4gIHB1YmxpYyBpc1NlbGVjdGVkID0gZmFsc2U7XG4gIHB1YmxpYyBwYWdlID0gMTtcbiAgcHVibGljIGNvdW50ID0gbnVsbDtcbiAgcHVibGljIHNvcnRTdGF0ZSA9IG5ldyBNYXAoKTtcbiAgcHVibGljIHNvcnRLZXkgPSBudWxsO1xuICBwdWJsaWMgcm93Q29udGV4dE1lbnVQb3NpdGlvbjogUm93Q29udGV4dE1lbnVQb3NpdGlvbiA9IHtcbiAgICB0b3A6IG51bGwsXG4gICAgbGVmdDogbnVsbCxcbiAgICB2YWx1ZTogbnVsbCxcbiAgfTtcbiAgcHVibGljIGxpbWl0O1xuICBwdWJsaWMgc29ydEJ5OiB7IGtleTogc3RyaW5nIH0gJiB7IG9yZGVyOiBzdHJpbmcgfSA9IHtcbiAgICBrZXk6ICcnLFxuICAgIG9yZGVyOiAnYXNjJyxcbiAgfTtcbiAgcHVibGljIHNlbGVjdGVkRGV0YWlsc1RlbXBsYXRlUm93SWQgPSBuZXcgU2V0KCk7XG4gIHB1YmxpYyBzdGFydE9mZnNldDtcbiAgcHVibGljIGxvYWRpbmdIZWlnaHQgPSAnMzBweCc7XG4gIHB1YmxpYyBjb25maWc6IENvbmZpZztcbiAgb25TZWxlY3RBbGxCaW5kZWQgPSB0aGlzLm9uU2VsZWN0QWxsLmJpbmQodGhpcyk7XG5cbiAgQElucHV0KCdjb25maWd1cmF0aW9uJylcbiAgc2V0IGNvbmZpZ3VyYXRpb24odmFsdWU6IENvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gdmFsdWU7XG4gIH1cblxuICBnZXQgY29uZmlndXJhdGlvbigpOiBDb25maWcge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZztcbiAgfVxuXG4gIEBJbnB1dCgpIGRhdGE6IGFueVtdO1xuICBASW5wdXQoKSBwYWdpbmF0aW9uOiBQYWdpbmF0aW9uO1xuICBASW5wdXQoKSBncm91cFJvd3NCeTogc3RyaW5nO1xuICBASW5wdXQoKSBpZCA9ICd0YWJsZSc7XG4gIEBJbnB1dCgpIHRvZ2dsZVJvd0luZGV4O1xuICBASW5wdXQoKSBkZXRhaWxzVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpIHN1bW1hcnlUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgZ3JvdXBSb3dzSGVhZGVyVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpIGZpbHRlcnNUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgc2VsZWN0QWxsVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpIG5vUmVzdWx0c1RlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICBASW5wdXQoKSByb3dDb250ZXh0TWVudTogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgY29sdW1uczogQ29sdW1uc1tdO1xuICBAT3V0cHV0KCkgcmVhZG9ubHkgZXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPHsgZXZlbnQ6IHN0cmluZywgdmFsdWU6IGFueSB9PigpO1xuICBAQ29udGVudENoaWxkKFRlbXBsYXRlUmVmKSBwdWJsaWMgcm93VGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjZHI6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuY29sdW1ucykge1xuICAgICAgY29uc29sZS5lcnJvcignW2NvbHVtbnNdIHByb3BlcnR5IHJlcXVpcmVkIScpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uKSB7XG4gICAgICBEZWZhdWx0Q29uZmlnU2VydmljZS5jb25maWcgPSB0aGlzLmNvbmZpZ3VyYXRpb247XG4gICAgfVxuICAgIHRoaXMuY29uZmlnID0gRGVmYXVsdENvbmZpZ1NlcnZpY2UuY29uZmlnO1xuICAgIHRoaXMubGltaXQgPSB0aGlzLmNvbmZpZy5yb3dzO1xuICAgIGlmICh0aGlzLmdyb3VwUm93c0J5KSB7XG4gICAgICB0aGlzLmdyb3VwZWQgPSBHcm91cFJvd3NTZXJ2aWNlLmRvR3JvdXBSb3dzKHRoaXMuZGF0YSwgdGhpcy5ncm91cFJvd3NCeSk7XG4gICAgfVxuICAgIHRoaXMuZG9EZWNvZGVQZXJzaXN0ZWRTdGF0ZSgpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGNvbnN0IGRhdGE6IFNpbXBsZUNoYW5nZSA9IGNoYW5nZXMuZGF0YTtcbiAgICBjb25zdCBwYWdpbmF0aW9uOiBTaW1wbGVDaGFuZ2UgPSBjaGFuZ2VzLnBhZ2luYXRpb247XG4gICAgY29uc3QgZ3JvdXBSb3dzQnk6IFNpbXBsZUNoYW5nZSA9IGNoYW5nZXMuZ3JvdXBSb3dzQnk7XG4gICAgdGhpcy50b2dnbGVSb3dJbmRleCA9IGNoYW5nZXMudG9nZ2xlUm93SW5kZXg7XG4gICAgaWYgKGRhdGEgJiYgZGF0YS5jdXJyZW50VmFsdWUpIHtcbiAgICAgIHRoaXMuZG9BcHBseURhdGEoZGF0YSk7XG4gICAgfVxuICAgIGlmIChwYWdpbmF0aW9uICYmIHBhZ2luYXRpb24uY3VycmVudFZhbHVlKSB7XG4gICAgICB0aGlzLmNvdW50ID0gcGFnaW5hdGlvbi5jdXJyZW50VmFsdWUuY291bnQ7XG4gICAgfVxuICAgIGlmIChncm91cFJvd3NCeSAmJiBncm91cFJvd3NCeS5jdXJyZW50VmFsdWUpIHtcbiAgICAgIHRoaXMuZ3JvdXBlZCA9IEdyb3VwUm93c1NlcnZpY2UuZG9Hcm91cFJvd3ModGhpcy5kYXRhLCB0aGlzLmdyb3VwUm93c0J5KTtcbiAgICB9XG4gICAgaWYgKHRoaXMudG9nZ2xlUm93SW5kZXggJiYgdGhpcy50b2dnbGVSb3dJbmRleC5jdXJyZW50VmFsdWUpIHtcbiAgICAgIGNvbnN0IHJvdyA9IHRoaXMudG9nZ2xlUm93SW5kZXguY3VycmVudFZhbHVlO1xuICAgICAgdGhpcy5jb2xsYXBzZVJvdyhyb3cuaW5kZXgpO1xuICAgIH1cbiAgfVxuXG4gIGlzT3JkZXJFbmFibGVkKGNvbHVtbjogQ29sdW1ucykge1xuICAgIGNvbnN0IGNvbHVtbk9yZGVyRW5hYmxlZCA9IGNvbHVtbi5vcmRlckVuYWJsZWQgPT09IHVuZGVmaW5lZCA/IHRydWUgOiAhIWNvbHVtbi5vcmRlckVuYWJsZWQ7XG4gICAgcmV0dXJuIERlZmF1bHRDb25maWdTZXJ2aWNlLmNvbmZpZy5vcmRlckVuYWJsZWQgJiYgY29sdW1uT3JkZXJFbmFibGVkO1xuICB9XG5cbiAgb3JkZXJCeShjb2x1bW46IENvbHVtbnMpOiB2b2lkIHtcbiAgICBpZiAodHlwZW9mIGNvbHVtbi5vcmRlckVuYWJsZWQgIT09ICd1bmRlZmluZWQnICYmICFjb2x1bW4ub3JkZXJFbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuc29ydEtleSA9IGNvbHVtbi5rZXk7XG4gICAgaWYgKCFEZWZhdWx0Q29uZmlnU2VydmljZS5jb25maWcub3JkZXJFbmFibGVkIHx8IHRoaXMuc29ydEtleSA9PT0gJycpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnNldENvbHVtbk9yZGVyKHRoaXMuc29ydEtleSk7XG4gICAgaWYgKCFEZWZhdWx0Q29uZmlnU2VydmljZS5jb25maWcub3JkZXJFdmVudE9ubHkgJiYgIWNvbHVtbi5vcmRlckV2ZW50T25seSkge1xuICAgICAgdGhpcy5zb3J0Qnkua2V5ID0gdGhpcy5zb3J0S2V5O1xuICAgICAgdGhpcy5zb3J0Qnkub3JkZXIgPSB0aGlzLnNvcnRTdGF0ZS5nZXQodGhpcy5zb3J0S2V5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zb3J0Qnkua2V5ID0gJyc7XG4gICAgICB0aGlzLnNvcnRCeS5vcmRlciA9ICcnO1xuICAgIH1cbiAgICBpZiAoIURlZmF1bHRDb25maWdTZXJ2aWNlLmNvbmZpZy5zZXJ2ZXJQYWdpbmF0aW9uKSB7XG4gICAgICB0aGlzLmRhdGEgPSBbLi4udGhpcy5kYXRhXTtcbiAgICB9XG4gICAgdGhpcy5zb3J0QnkgPSB7IC4uLnRoaXMuc29ydEJ5IH07XG4gICAgY29uc3QgdmFsdWUgPSB7XG4gICAgICBrZXk6IHRoaXMuc29ydEtleSxcbiAgICAgIG9yZGVyOiB0aGlzLnNvcnRTdGF0ZS5nZXQodGhpcy5zb3J0S2V5KSxcbiAgICB9O1xuICAgIHRoaXMuZW1pdEV2ZW50KEV2ZW50Lm9uT3JkZXIsIHZhbHVlKTtcbiAgfVxuXG4gIG9uQ2xpY2soJGV2ZW50OiBNb3VzZUV2ZW50LCByb3c6IG9iamVjdCwga2V5OiBDb2x1bW5LZXlUeXBlLCBjb2xJbmRleDogbnVtYmVyIHwgbnVsbCwgcm93SW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIGlmIChEZWZhdWx0Q29uZmlnU2VydmljZS5jb25maWcuc2VsZWN0Um93KSB7XG4gICAgICB0aGlzLnNlbGVjdGVkUm93ID0gcm93SW5kZXg7XG4gICAgfVxuICAgIGlmIChEZWZhdWx0Q29uZmlnU2VydmljZS5jb25maWcuc2VsZWN0Q29sICYmIGNvbEluZGV4KSB7XG4gICAgICB0aGlzLnNlbGVjdGVkQ29sID0gY29sSW5kZXg7XG4gICAgfVxuICAgIGlmIChEZWZhdWx0Q29uZmlnU2VydmljZS5jb25maWcuc2VsZWN0Q2VsbCAmJiBjb2xJbmRleCkge1xuICAgICAgdGhpcy5zZWxlY3RlZFJvdyA9IHJvd0luZGV4O1xuICAgICAgdGhpcy5zZWxlY3RlZENvbCA9IGNvbEluZGV4O1xuICAgIH1cbiAgICBpZiAoRGVmYXVsdENvbmZpZ1NlcnZpY2UuY29uZmlnLmNsaWNrRXZlbnQpIHtcbiAgICAgIGNvbnN0IHZhbHVlOiBUYWJsZU1vdXNlRXZlbnQgPSB7XG4gICAgICAgIGV2ZW50OiAkZXZlbnQsXG4gICAgICAgIHJvdyxcbiAgICAgICAga2V5LFxuICAgICAgICByb3dJZDogcm93SW5kZXgsXG4gICAgICAgIGNvbElkOiBjb2xJbmRleCxcbiAgICAgIH07XG4gICAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vbkNsaWNrLCB2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgb25Eb3VibGVDbGljaygkZXZlbnQ6IE1vdXNlRXZlbnQsIHJvdzogb2JqZWN0LCBrZXk6IENvbHVtbktleVR5cGUsIGNvbEluZGV4OiBudW1iZXIgfCBudWxsLCByb3dJbmRleDogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgdmFsdWU6IFRhYmxlTW91c2VFdmVudCA9IHtcbiAgICAgIGV2ZW50OiAkZXZlbnQsXG4gICAgICByb3csXG4gICAgICBrZXksXG4gICAgICByb3dJZDogcm93SW5kZXgsXG4gICAgICBjb2xJZDogY29sSW5kZXgsXG4gICAgfTtcbiAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vbkRvdWJsZUNsaWNrLCB2YWx1ZSk7XG4gIH1cblxuICBvbkNoZWNrYm94U2VsZWN0KCRldmVudDogb2JqZWN0LCByb3c6IG9iamVjdCwgcm93SW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IHZhbHVlID0ge1xuICAgICAgZXZlbnQ6ICRldmVudCxcbiAgICAgIHJvdyxcbiAgICAgIHJvd0lkOiByb3dJbmRleCxcbiAgICB9O1xuICAgIHRoaXMuZW1pdEV2ZW50KEV2ZW50Lm9uQ2hlY2tib3hTZWxlY3QsIHZhbHVlKTtcbiAgfVxuXG4gIG9uU2VsZWN0QWxsKCkge1xuICAgIHRoaXMuaXNTZWxlY3RlZCA9ICF0aGlzLmlzU2VsZWN0ZWQ7XG4gICAgdGhpcy5lbWl0RXZlbnQoRXZlbnQub25TZWxlY3RBbGwsIHRoaXMuaXNTZWxlY3RlZCk7XG4gIH1cblxuICBvblNlYXJjaCgkZXZlbnQ6IEFycmF5PHsga2V5OiBzdHJpbmc7IHZhbHVlOiBzdHJpbmcgfT4pOiB2b2lkIHtcbiAgICBpZiAoIURlZmF1bHRDb25maWdTZXJ2aWNlLmNvbmZpZy5zZXJ2ZXJQYWdpbmF0aW9uKSB7XG4gICAgICB0aGlzLnRlcm0gPSAkZXZlbnQ7XG4gICAgfVxuICAgIHRoaXMuZW1pdEV2ZW50KEV2ZW50Lm9uU2VhcmNoLCAkZXZlbnQpO1xuICB9XG5cbiAgb25HbG9iYWxTZWFyY2godmFsdWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICghRGVmYXVsdENvbmZpZ1NlcnZpY2UuY29uZmlnLnNlcnZlclBhZ2luYXRpb24pIHtcbiAgICAgIHRoaXMuZ2xvYmFsU2VhcmNoVGVybSA9IHZhbHVlO1xuICAgIH1cbiAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vbkdsb2JhbFNlYXJjaCwgdmFsdWUpO1xuICB9XG5cbiAgb25QYWdpbmF0aW9uKHBhZ2luYXRpb246IFBhZ2luYXRpb25SYW5nZSk6IHZvaWQge1xuICAgIHRoaXMucGFnZSA9IHBhZ2luYXRpb24ucGFnZTtcbiAgICB0aGlzLmxpbWl0ID0gcGFnaW5hdGlvbi5saW1pdDtcbiAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vblBhZ2luYXRpb24sIHBhZ2luYXRpb24pO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0RXZlbnQoZXZlbnQ6IHN0cmluZywgdmFsdWU6IGFueSk6IHZvaWQge1xuICAgIHRoaXMuZXZlbnQuZW1pdCh7IGV2ZW50LCB2YWx1ZSB9KTtcbiAgICBpZiAodGhpcy5jb25maWcucGVyc2lzdFN0YXRlKSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShldmVudCwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY29uZmlnLmxvZ2dlcikge1xuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbnNvbGVcbiAgICAgIGNvbnNvbGUubG9nKHsgZXZlbnQsIHZhbHVlIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbGxhcHNlUm93KHJvd0luZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zZWxlY3RlZERldGFpbHNUZW1wbGF0ZVJvd0lkLmhhcyhyb3dJbmRleCkpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWREZXRhaWxzVGVtcGxhdGVSb3dJZC5kZWxldGUocm93SW5kZXgpO1xuICAgICAgdGhpcy5lbWl0RXZlbnQoRXZlbnQub25Sb3dDb2xsYXBzZWRIaWRlLCByb3dJbmRleCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWREZXRhaWxzVGVtcGxhdGVSb3dJZC5hZGQocm93SW5kZXgpO1xuICAgICAgdGhpcy5lbWl0RXZlbnQoRXZlbnQub25Sb3dDb2xsYXBzZWRTaG93LCByb3dJbmRleCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkb0RlY29kZVBlcnNpc3RlZFN0YXRlKCkge1xuICAgIGlmICghdGhpcy5jb25maWcucGVyc2lzdFN0YXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHBhZ2luYXRpb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShFdmVudC5vblBhZ2luYXRpb24pO1xuICAgIGNvbnN0IHNvcnQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShFdmVudC5vbk9yZGVyKTtcbiAgICBjb25zdCBzZWFyY2ggPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShFdmVudC5vblNlYXJjaCk7XG4gICAgaWYgKHBhZ2luYXRpb24pIHtcbiAgICAgIHRoaXMub25QYWdpbmF0aW9uKEpTT04ucGFyc2UocGFnaW5hdGlvbikpO1xuICAgIH1cbiAgICBpZiAoc29ydCkge1xuICAgICAgY29uc3QgeyBrZXksIG9yZGVyIH0gPSBKU09OLnBhcnNlKHNvcnQpO1xuICAgICAgdGhpcy5zb3J0Qnkua2V5ID0ga2V5O1xuICAgICAgdGhpcy5zb3J0Qnkub3JkZXIgPSBvcmRlcjtcbiAgICAgIHRoaXMuZGF0YSA9IFsuLi50aGlzLmRhdGFdO1xuICAgIH1cbiAgICBpZiAoc2VhcmNoKSB7XG4gICAgICB0aGlzLnRlcm0gPSBKU09OLnBhcnNlKHNlYXJjaCk7XG4gICAgfVxuICB9XG5cbiAgaXNSb3dDb2xsYXBzZWQocm93SW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmNvbmZpZy5jb2xsYXBzZUFsbFJvd3MpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zZWxlY3RlZERldGFpbHNUZW1wbGF0ZVJvd0lkLmhhcyhyb3dJbmRleCk7XG4gIH1cblxuICBvbk1vdXNlRG93bihldmVudCwgdGgpIHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLnJlc2l6ZUNvbHVtbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnRoID0gdGg7XG4gICAgdGhpcy5zdGFydE9mZnNldCA9IHRoLm9mZnNldFdpZHRoIC0gZXZlbnQucGFnZVg7XG4gICAgdGhpcy5lbWl0RXZlbnQoRXZlbnQub25Db2x1bW5SZXNpemVNb3VzZURvd24sIGV2ZW50KTtcbiAgfVxuXG4gIG9uTW91c2VNb3ZlKGV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5yZXNpemVDb2x1bW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMudGggJiYgdGhpcy50aC5zdHlsZSkge1xuICAgICAgdGhpcy50aC5zdHlsZS53aWR0aCA9IHRoaXMuc3RhcnRPZmZzZXQgKyBldmVudC5wYWdlWCArICdweCc7XG4gICAgICB0aGlzLnRoLnN0eWxlLmN1cnNvciA9ICdjb2wtcmVzaXplJztcbiAgICAgIHRoaXMudGguc3R5bGVbJ3VzZXItc2VsZWN0J10gPSAnbm9uZSc7XG4gICAgfVxuICB9XG5cbiAgb25Nb3VzZVVwKGV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5yZXNpemVDb2x1bW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5lbWl0RXZlbnQoRXZlbnQub25Db2x1bW5SZXNpemVNb3VzZVVwLCBldmVudCk7XG4gICAgdGhpcy50aC5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7XG4gICAgdGhpcy50aCA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGdldCBpc0xvYWRpbmcoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFibGUnKSBhcyBIVE1MVGFibGVFbGVtZW50O1xuICAgIGlmICh0YWJsZSAmJiB0YWJsZS5yb3dzICYmIHRhYmxlLnJvd3MubGVuZ3RoID4gMykge1xuICAgICAgdGhpcy5nZXRMb2FkaW5nSGVpZ2h0KHRhYmxlLnJvd3MpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jb25maWcuaXNMb2FkaW5nO1xuICB9XG5cbiAgZ2V0TG9hZGluZ0hlaWdodChyb3dzOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBzZWFyY2hFbmFibGVkID0gdGhpcy5jb25maWcuc2VhcmNoRW5hYmxlZCA/IDEgOiAwO1xuICAgIGNvbnN0IGhlYWRlckVuYWJsZWQgPSB0aGlzLmNvbmZpZy5oZWFkZXJFbmFibGVkID8gMSA6IDA7XG4gICAgY29uc3QgYm9yZGVyVHJIZWlnaHQgPSAxO1xuICAgIGNvbnN0IGJvcmRlckRpdkhlaWdodCA9IDI7XG4gICAgdGhpcy5sb2FkaW5nSGVpZ2h0ID0gKHJvd3MubGVuZ3RoIC0gc2VhcmNoRW5hYmxlZCAtIGhlYWRlckVuYWJsZWQpICogKHJvd3NbM10ub2Zmc2V0SGVpZ2h0IC0gYm9yZGVyVHJIZWlnaHQpIC0gYm9yZGVyRGl2SGVpZ2h0ICsgJ3B4JztcbiAgfVxuXG4gIGdldENvbHVtbldpZHRoKGNvbHVtbjogYW55KTogc3RyaW5nIHwgbnVsbCB7XG4gICAgaWYgKGNvbHVtbi53aWR0aCkge1xuICAgICAgcmV0dXJuIGNvbHVtbi53aWR0aDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmZpeGVkQ29sdW1uV2lkdGggPyAxMDAgLyB0aGlzLmNvbHVtbnMubGVuZ3RoICsgJyUnIDogbnVsbDtcbiAgfVxuXG4gIGdldENvbHVtbkRlZmluaXRpb24oY29sdW1uOiBDb2x1bW5zKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGNvbHVtbi5zZWFyY2hFbmFibGVkIHx8IHR5cGVvZiBjb2x1bW4uc2VhcmNoRW5hYmxlZCA9PT0gJ3VuZGVmaW5lZCc7XG4gIH1cblxuICBnZXQgYXJyb3dEZWZpbml0aW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5zaG93RGV0YWlsc0Fycm93IHx8IHR5cGVvZiB0aGlzLmNvbmZpZy5zaG93RGV0YWlsc0Fycm93ID09PSAndW5kZWZpbmVkJztcbiAgfVxuXG4gIG9uUm93Q29udGV4dE1lbnUoJGV2ZW50OiBNb3VzZUV2ZW50LCByb3c6IG9iamVjdCwga2V5OiBDb2x1bW5LZXlUeXBlLCBjb2xJbmRleDogbnVtYmVyIHwgbnVsbCwgcm93SW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICghdGhpcy5jb25maWcuc2hvd0NvbnRleHRNZW51KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHZhbHVlOiBUYWJsZU1vdXNlRXZlbnQgPSB7XG4gICAgICBldmVudDogJGV2ZW50LFxuICAgICAgcm93LFxuICAgICAga2V5LFxuICAgICAgcm93SWQ6IHJvd0luZGV4LFxuICAgICAgY29sSWQ6IGNvbEluZGV4LFxuICAgIH07XG4gICAgdGhpcy5yb3dDb250ZXh0TWVudVBvc2l0aW9uID0ge1xuICAgICAgdG9wOiBgJHskZXZlbnQueSAtIDEwfXB4YCxcbiAgICAgIGxlZnQ6IGAkeyRldmVudC54IC0gMTB9cHhgLFxuICAgICAgdmFsdWUsXG4gICAgfTtcblxuICAgIHRoaXMuZW1pdEV2ZW50KEV2ZW50Lm9uUm93Q29udGV4dE1lbnUsIHZhbHVlKTtcbiAgfVxuXG4gIHByaXZhdGUgZG9BcHBseURhdGEoZGF0YSkge1xuICAgIGNvbnN0IGNvbHVtbiA9IHRoaXMuY29sdW1ucy5maW5kKChjKSA9PiAhIWMub3JkZXJCeSk7XG4gICAgaWYgKGNvbHVtbikge1xuICAgICAgdGhpcy5zb3J0U3RhdGUuc2V0KHRoaXMuc29ydEtleSwgKGNvbHVtbi5vcmRlckJ5ID09PSAnYXNjJykgPyAnZGVzYycgOiAnYXNjJyk7XG4gICAgICB0aGlzLm9yZGVyQnkoY29sdW1uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kYXRhID0gWy4uLmRhdGEuY3VycmVudFZhbHVlXTtcbiAgICB9XG4gIH1cblxuICBvbkRyb3AoZXZlbnQ6IENka0RyYWdEcm9wPHN0cmluZ1tdPikge1xuICAgIHRoaXMuZW1pdEV2ZW50KEV2ZW50Lm9uUm93RHJvcCwgZXZlbnQpO1xuICAgIG1vdmVJdGVtSW5BcnJheSh0aGlzLmRhdGEsIGV2ZW50LnByZXZpb3VzSW5kZXgsIGV2ZW50LmN1cnJlbnRJbmRleCk7XG4gIH1cblxuICAvLyBETyBOT1QgUkVNT1ZFLiBJdCBpcyBjYWxsZWQgZnJvbSBwYXJlbnQgY29tcG9uZW50LiBTZWUgc3JjL2FwcC9kZW1vL2FwaS1kb2MvYXBpLWRvYy5jb21wb25lbnQudHNcbiAgYXBpRXZlbnQoZXZlbnQ6IEFwaVR5cGUpOiB2b2lkIHwgbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5iaW5kQXBpKGV2ZW50KTtcbiAgfVxuXG4gIC8vIHRzbGludDpkaXNhYmxlOm5vLWJpZy1mdW5jdGlvbiBjb2duaXRpdmUtY29tcGxleGl0eVxuICBwcml2YXRlIGJpbmRBcGkoZXZlbnQ6IEFwaVR5cGUpOiB2b2lkIHwgbnVtYmVyIHtcbiAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHtcbiAgICAgIGNhc2UgQVBJLnJvd0NvbnRleHRNZW51Q2xpY2tlZDpcbiAgICAgICAgdGhpcy5yb3dDb250ZXh0TWVudVBvc2l0aW9uID0ge1xuICAgICAgICAgIHRvcDogbnVsbCxcbiAgICAgICAgICBsZWZ0OiBudWxsLFxuICAgICAgICAgIHZhbHVlOiBudWxsLFxuICAgICAgICB9O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQVBJLnRvb2xQYW5lbENsaWNrZWQ6XG4gICAgICAgIC8vIFRPRE9cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEFQSS5zZXRJbnB1dFZhbHVlOlxuICAgICAgICBpZiAodGhpcy5jb25maWcuc2VhcmNoRW5hYmxlZCkge1xuICAgICAgICAgIGV2ZW50LnZhbHVlLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBzZWFyY2hfJHtpbnB1dC5rZXl9YCkgYXMgSFRNTElucHV0RWxlbWVudCk7XG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgQ29sdW1uICcke2lucHV0LmtleX0nIG5vdCBhdmFpbGFibGUgaW4gdGhlIERPTS4gSGF2ZSB5b3UgbWlzc3BlbGxlZCBhIG5hbWU/YCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBlbGVtZW50LnZhbHVlID0gaW5wdXQudmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vblNlYXJjaChldmVudC52YWx1ZSk7XG4gICAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEFQSS5vbkdsb2JhbFNlYXJjaDpcbiAgICAgICAgdGhpcy5vbkdsb2JhbFNlYXJjaChldmVudC52YWx1ZSk7XG4gICAgICAgIHRoaXMuY2RyLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEFQSS5zZXRSb3dDbGFzczpcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQudmFsdWUpKSB7XG4gICAgICAgICAgZXZlbnQudmFsdWUuZm9yRWFjaCgodmFsKSA9PiBTdHlsZVNlcnZpY2Uuc2V0Um93Q2xhc3ModmFsKSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgU3R5bGVTZXJ2aWNlLnNldFJvd0NsYXNzKGV2ZW50LnZhbHVlKTtcbiAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQVBJLnNldENlbGxDbGFzczpcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQudmFsdWUpKSB7XG4gICAgICAgICAgZXZlbnQudmFsdWUuZm9yRWFjaCgodmFsKSA9PiBTdHlsZVNlcnZpY2Uuc2V0Q2VsbENsYXNzKHZhbCkpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIFN0eWxlU2VydmljZS5zZXRDZWxsQ2xhc3MoZXZlbnQudmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQVBJLnNldFJvd1N0eWxlOlxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShldmVudC52YWx1ZSkpIHtcbiAgICAgICAgICBldmVudC52YWx1ZS5mb3JFYWNoKCh2YWwpID0+IFN0eWxlU2VydmljZS5zZXRSb3dTdHlsZSh2YWwpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBTdHlsZVNlcnZpY2Uuc2V0Um93U3R5bGUoZXZlbnQudmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQVBJLnNldENlbGxTdHlsZTpcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQudmFsdWUpKSB7XG4gICAgICAgICAgZXZlbnQudmFsdWUuZm9yRWFjaCgodmFsKSA9PiBTdHlsZVNlcnZpY2Uuc2V0Q2VsbFN0eWxlKHZhbCkpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIFN0eWxlU2VydmljZS5zZXRDZWxsU3R5bGUoZXZlbnQudmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQVBJLnNldFRhYmxlQ2xhc3M6XG4gICAgICAgIHRoaXMudGFibGVDbGFzcyA9IGV2ZW50LnZhbHVlO1xuICAgICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBBUEkuZ2V0UGFnaW5hdGlvblRvdGFsSXRlbXM6XG4gICAgICAgIHJldHVybiB0aGlzLnBhZ2luYXRpb25Db21wb25lbnQucGFnaW5hdGlvbkRpcmVjdGl2ZS5nZXRUb3RhbEl0ZW1zKCk7XG4gICAgICBjYXNlIEFQSS5zZXRQYWdpbmF0aW9uQ3VycmVudFBhZ2U6XG4gICAgICAgIHRoaXMucGFnaW5hdGlvbkNvbXBvbmVudC5wYWdpbmF0aW9uRGlyZWN0aXZlLnNldEN1cnJlbnQoZXZlbnQudmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQVBJLnNldFBhZ2luYXRpb25SYW5nZTpcbiAgICAgICAgdGhpcy5wYWdpbmF0aW9uQ29tcG9uZW50LnJhbmdlcyA9IGV2ZW50LnZhbHVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQVBJLnNldFBhZ2luYXRpb25QcmV2aW91c0xhYmVsOlxuICAgICAgICB0aGlzLnBhZ2luYXRpb25Db21wb25lbnQucHJldmlvdXNMYWJlbCA9IGV2ZW50LnZhbHVlO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQVBJLnNldFBhZ2luYXRpb25OZXh0TGFiZWw6XG4gICAgICAgIHRoaXMucGFnaW5hdGlvbkNvbXBvbmVudC5uZXh0TGFiZWwgPSBldmVudC52YWx1ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEFQSS5zZXRQYWdpbmF0aW9uRGlzcGxheUxpbWl0OlxuICAgICAgICB0aGlzLnBhZ2luYXRpb25Db21wb25lbnQuY2hhbmdlTGltaXQoZXZlbnQudmFsdWUsIHRydWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQVBJLnNvcnRCeTpcbiAgICAgICAgY29uc3QgY29sdW1uOiBDb2x1bW5zID0geyB0aXRsZTogJycsIGtleTogZXZlbnQudmFsdWUuY29sdW1uLCBvcmRlckJ5OiBldmVudC52YWx1ZS5vcmRlciB9O1xuICAgICAgICB0aGlzLm9yZGVyQnkoY29sdW1uKTtcbiAgICAgICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0Q29sdW1uT3JkZXIoa2V5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBzd2l0Y2ggKHRoaXMuc29ydFN0YXRlLmdldChrZXkpKSB7XG4gICAgICBjYXNlICcnOlxuICAgICAgY2FzZSB1bmRlZmluZWQ6XG4gICAgICAgIHRoaXMuc29ydFN0YXRlLnNldChrZXksICdkZXNjJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnYXNjJzpcbiAgICAgICAgdGhpcy5jb25maWcudGhyZWVXYXlTb3J0ID9cbiAgICAgICAgICB0aGlzLnNvcnRTdGF0ZS5zZXQoa2V5LCAnJykgOlxuICAgICAgICAgIHRoaXMuc29ydFN0YXRlLnNldChrZXksICdkZXNjJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZGVzYyc6XG4gICAgICAgIHRoaXMuc29ydFN0YXRlLnNldChrZXksICdhc2MnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmICh0aGlzLnNvcnRTdGF0ZS5zaXplID4gMSkge1xuICAgICAgY29uc3QgdGVtcCA9IHRoaXMuc29ydFN0YXRlLmdldChrZXkpO1xuICAgICAgdGhpcy5zb3J0U3RhdGUuY2xlYXIoKTtcbiAgICAgIHRoaXMuc29ydFN0YXRlLnNldChrZXksIHRlbXApO1xuICAgIH1cbiAgfVxufVxuIl19